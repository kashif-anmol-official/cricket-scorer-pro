generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model Match {
  id         String    @id @default(uuid())
  name       String?
  date       DateTime  @default(now())
  oversLimit Int       @default(20)
  tossWinner String?
  tossChoice String?
  status     String    @default("live")
  teams      Team[]
  innings    Innings[]
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
}

model Team {
  id      String   @id @default(uuid())
  name    String
  matchId String
  match   Match    @relation(fields: [matchId], references: [id])
  players Player[]

  battingInnings Innings[] @relation("BattingTeam")
  bowlingInnings Innings[] @relation("BowlingTeam")
}

model Player {
  id     String @id @default(uuid())
  name   String
  teamId String
  team   Team   @relation(fields: [teamId], references: [id])

  strikerEvents    BallEvent[] @relation("Striker")
  nonStrikerEvents BallEvent[] @relation("NonStriker")
  bowlerEvents     BallEvent[] @relation("Bowler")
  wicketEvents     BallEvent[] @relation("OutPlayer")
  assistEvents     BallEvent[] @relation("AssistPlayer")
}

model Innings {
  id            String      @id @default(uuid())
  matchId       String
  match         Match       @relation(fields: [matchId], references: [id])
  battingTeamId String
  battingTeam   Team        @relation("BattingTeam", fields: [battingTeamId], references: [id])
  bowlingTeamId String
  bowlingTeam   Team        @relation("BowlingTeam", fields: [bowlingTeamId], references: [id])
  inningsNumber Int         @default(1)
  events        BallEvent[]
}

model BallEvent {
  id        String  @id @default(uuid())
  inningsId String
  innings   Innings @relation(fields: [inningsId], references: [id])

  overNumber Int
  ballNumber Int

  strikerId    String
  striker      Player @relation("Striker", fields: [strikerId], references: [id])
  nonStrikerId String
  nonStriker   Player @relation("NonStriker", fields: [nonStrikerId], references: [id])
  bowlerId     String
  bowler       Player @relation("Bowler", fields: [bowlerId], references: [id])

  runsScored Int     @default(0)
  extrasRuns Int     @default(0)
  extrasType String?

  isWicket    Boolean @default(false)
  wicketType  String?
  outPlayerId String?
  outPlayer   Player? @relation("OutPlayer", fields: [outPlayerId], references: [id])
  assisterId  String?
  assister    Player? @relation("AssistPlayer", fields: [assisterId], references: [id])

  timestamp DateTime @default(now())
}
